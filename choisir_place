<?PHP 
session_start();
?>
<html>
    <head>
        <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    	<link href="style.css" rel="stylesheet">
    	<meta charset="utf-8">
        <title>UPARK | Home <?php echo $_SESSION['membreid'];?></title>
		<style type="text/css">
		body {background-color:#eeeeee}

		</style>
    </head>
<body>
<?php include ('header.php'); ?>	
	<?php
		include "connect.php";
		$conn=Connect();
		if(is_null($conn))
			echo "connect error";
		$parking=$_SESSION['parking'];
		if (isset($_POST["choisir_place"])) 
		{
			$date_debut=$_POST["datedebut"];
			$date_fin=$_POST["datefin"];
			$num=$_POST["num_place"];
		}
		
		/*obtenir immatriculation par login*/
		$login =$_SESSION['membreid'];
		
		$request_login = pg_query($conn, "SELECT immatriculation FROM Vehicule where proprietaire = '$login'   ");
		$row = pg_fetch_row($request_login);
		$immatriculation=$row[0];
		
		/*insert  le reservation*/
		$sql="insert into occupe(immatriculation,nom_park,numero,date_debut,date_fin) values ('$immatriculation','$parking','$num','$date_debut','$date_fin')";
		//echo $sql;
		$query = pg_query($conn,$sql);
		
		/*update free_place*/
		if(!is_null($query))
		{
			echo "<h1 style='color : #ff0000'>réservation succès</h1>";
			$query = pg_query($conn, "UPDATE parking set free_places=free_places-1 where nom_park='$parking'");
		}
		
		echo "</table><h1>DANS '$parking' LES TEMPS OCCUPE CI-DESOUS</h1>";
		$request_place = pg_query($conn, "SELECT o.numero,o.date_debut,o.date_fin FROM occupe o where o.nom_park = '$parking'   ");
		if(is_null($request_place))
			echo "query error";
		echo "<table class='table table-bordered table-striped'><tr><th>num_place</th><th>date_debut</th><th>date_fin</th></tr>";
		while ($row = pg_fetch_row($request_place)) {
			echo "<tr><td>$row[0]</td><td>$row[1]</td><td>$row[2]</td></tr>";
			if(is_null($row))
			{
				echo "TOUTES PLACE SONT LIBRE!";
			}
		}
		echo "</table>";
		
	?>
	
	<label><a href="reserver.php" style='color=#000000'>RETOUNER A PAGE RESEVER</a></label>
</body>
</html>
